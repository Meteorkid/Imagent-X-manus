<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è„šæœ¬åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #007bff; }
    </style>
</head>
<body>
    <h1>ğŸ” è„šæœ¬åŠ è½½æµ‹è¯•</h1>
    
    <div class="test-panel">
        <h3>ğŸ“¥ è„šæœ¬åŠ è½½æµ‹è¯•</h3>
        <button onclick="loadScript()">åŠ è½½è„šæœ¬</button>
        <button onclick="checkGlobals()">æ£€æŸ¥å…¨å±€å˜é‡</button>
        <button onclick="testInit()">æµ‹è¯•åˆå§‹åŒ–</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>

    <div class="test-panel">
        <h3>ğŸ“ è¯¦ç»†æ—¥å¿—</h3>
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function loadScript() {
            log('ğŸ“¥ å¼€å§‹åŠ è½½è„šæœ¬...', 'info');
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½
            const existingScript = document.querySelector('script[src*="offline-game"]');
            if (existingScript) {
                log('âš ï¸ è„šæœ¬å·²å­˜åœ¨ï¼Œç§»é™¤æ—§è„šæœ¬', 'warning');
                existingScript.remove();
            }

            // åˆ›å»ºæ–°è„šæœ¬
            const script = document.createElement('script');
            script.src = 'offline-game.js';
            
            script.onload = () => {
                log('âœ… è„šæœ¬åŠ è½½æˆåŠŸ', 'success');
                setTimeout(() => {
                    checkGlobals();
                }, 100);
            };
            
            script.onerror = (error) => {
                log(`âŒ è„šæœ¬åŠ è½½å¤±è´¥: ${error}`, 'error');
            };
            
            document.head.appendChild(script);
            log('ğŸ“„ è„šæœ¬æ ‡ç­¾å·²æ·»åŠ åˆ°é¡µé¢', 'info');
        }

        function checkGlobals() {
            log('ğŸ” æ£€æŸ¥å…¨å±€å˜é‡...', 'info');
            
            // æ£€æŸ¥ window å¯¹è±¡
            if (typeof window !== 'undefined') {
                log('âœ… window å¯¹è±¡å­˜åœ¨', 'success');
            } else {
                log('âŒ window å¯¹è±¡ä¸å­˜åœ¨', 'error');
                return;
            }

            // æ£€æŸ¥ ImagentXOfflineGame ç±»
            if (typeof ImagentXOfflineGame !== 'undefined') {
                log('âœ… ImagentXOfflineGame ç±»å­˜åœ¨', 'success');
                log(`ğŸ“ ç±»æ„é€ å‡½æ•°: ${typeof ImagentXOfflineGame}`, 'info');
            } else {
                log('âŒ ImagentXOfflineGame ç±»ä¸å­˜åœ¨', 'error');
            }

            // æ£€æŸ¥ imagentxOffline å¯¹è±¡
            if (window.imagentxOffline) {
                log('âœ… imagentxOffline å¯¹è±¡å­˜åœ¨', 'success');
                log(`ğŸ“ å¯¹è±¡ç±»å‹: ${typeof window.imagentxOffline}`, 'info');
                
                if (typeof window.imagentxOffline.getStatus === 'function') {
                    log('âœ… getStatus æ–¹æ³•å­˜åœ¨', 'success');
                    const status = window.imagentxOffline.getStatus();
                    log(`ğŸ“Š çŠ¶æ€: ${JSON.stringify(status)}`, 'info');
                } else {
                    log('âŒ getStatus æ–¹æ³•ä¸å­˜åœ¨', 'error');
                }
            } else {
                log('âŒ imagentxOffline å¯¹è±¡ä¸å­˜åœ¨', 'error');
            }

            // æ£€æŸ¥ debugOfflineGame å‡½æ•°
            if (typeof window.debugOfflineGame === 'function') {
                log('âœ… debugOfflineGame å‡½æ•°å­˜åœ¨', 'success');
            } else {
                log('âŒ debugOfflineGame å‡½æ•°ä¸å­˜åœ¨', 'error');
            }

            // æ£€æŸ¥æ‰€æœ‰å…¨å±€å˜é‡
            const globals = Object.keys(window).filter(key => 
                key.includes('imagentx') || 
                key.includes('Offline') || 
                key.includes('Game') ||
                key.includes('debug')
            );
            
            if (globals.length > 0) {
                log(`ğŸ“‹ ç›¸å…³å…¨å±€å˜é‡: ${globals.join(', ')}`, 'info');
            } else {
                log('âš ï¸ æœªæ‰¾åˆ°ç›¸å…³å…¨å±€å˜é‡', 'warning');
            }
        }

        function testInit() {
            log('ğŸ”„ æµ‹è¯•åˆå§‹åŒ–...', 'info');
            
            if (typeof ImagentXOfflineGame === 'undefined') {
                log('âŒ ImagentXOfflineGame ç±»ä¸å­˜åœ¨ï¼Œæ— æ³•åˆå§‹åŒ–', 'error');
                return;
            }

            try {
                log('ğŸ“ åˆ›å»º ImagentXOfflineGame å®ä¾‹...', 'info');
                const instance = new ImagentXOfflineGame();
                log('âœ… å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                // æ£€æŸ¥å®ä¾‹æ–¹æ³•
                const methods = ['getStatus', 'showGame', 'hideGame', 'forceShowGame', 'forceHideGame'];
                methods.forEach(method => {
                    if (typeof instance[method] === 'function') {
                        log(`âœ… ${method} æ–¹æ³•å­˜åœ¨`, 'success');
                    } else {
                        log(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                    }
                });

                // è·å–çŠ¶æ€
                const status = instance.getStatus();
                log(`ğŸ“Š å®ä¾‹çŠ¶æ€: ${JSON.stringify(status)}`, 'info');

                // è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡
                window.imagentxOffline = instance;
                log('âœ… å®ä¾‹å·²è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡', 'success');
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                log(`ğŸ“ é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        window.addEventListener('load', () => {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('â³ ç­‰å¾… 2 ç§’åå¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');
            
            setTimeout(() => {
                loadScript();
            }, 2000);
        });

        // ç›‘å¬æ§åˆ¶å°é”™è¯¯
        const originalError = console.error;
        console.error = function(...args) {
            log(`âŒ æ§åˆ¶å°é”™è¯¯: ${args.join(' ')}`, 'error');
            originalError.apply(console, args);
        };

        // ç›‘å¬æ§åˆ¶å°æ—¥å¿—
        const originalLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('ç¦»çº¿') || message.includes('ImagentX') || message.includes('æ¸¸æˆ') || message.includes('åˆå§‹åŒ–')) {
                log(`ğŸ“ æ§åˆ¶å°: ${message}`, 'info');
            }
            originalLog.apply(console, args);
        };
    </script>
</body>
</html>
