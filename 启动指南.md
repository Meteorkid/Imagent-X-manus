# 🚀 ImagentX 项目启动指南

## 📋 系统要求

### 基础要求
- **操作系统**: macOS 10.15+, Linux (Ubuntu 18.04+), Windows 10+
- **内存**: 至少4GB RAM (推荐8GB+)
- **存储**: 至少10GB可用空间

### 开发环境
- **Java**: JDK 17+ (必需)
- **Node.js**: 18+ (必需)
- **npm**: 8+ (必需)
- **Git**: 2.20+ (推荐)

### 生产环境
- **Docker**: 20.10+ (推荐)
- **Docker Compose**: 2.0+ (推荐)
- **Nginx**: 1.18+ (外网部署)

## 🎯 启动方案

### 1. 本地开发模式 (推荐新手)

#### 环境准备
```bash
# 检查Java版本 (需要JDK 17+)
java -version

# 检查Node.js版本 (需要18+)
node --version
npm --version

# 如果Java版本不对，需要安装JDK 17
# macOS: brew install openjdk@17
# Ubuntu: sudo apt install openjdk-17-jdk
# Windows: 下载Oracle JDK 17
```

#### 快速启动
```bash
# 进入项目目录
cd /Users/Meteorkid/Downloads/ImagentX-master

# 快速启动 (仅前端)
./scripts/core/start.sh --quick

# 本地开发 (后端+前端)
./scripts/core/start.sh --local
```

#### 手动启动
```bash
# 1. 启动后端
cd apps/backend
./mvnw spring-boot:run

# 2. 启动前端 (新终端)
cd apps/frontend
npm install --legacy-peer-deps
npm run dev
```

**访问地址:**
- 前端: http://localhost:3000
- 后端API: http://localhost:8080

### 2. 内网部署模式 (推荐生产环境)

#### 使用Docker Compose
```bash
# 启动完整服务 (包含数据库、消息队列)
docker-compose -f config/docker/docker-compose-network.yml up -d

# 或者使用简化版本
docker-compose -f config/docker/docker-compose-imagentx.yml up -d
```

#### 使用启动脚本
```bash
# 核心服务启动
./scripts/core/start.sh --core

# 完整服务启动 (包含监控)
./scripts/core/start.sh --full
```

**服务信息:**
- 前端: http://localhost:3000
- 后端API: http://localhost:8088
- PostgreSQL: localhost:5432
- RabbitMQ: localhost:5672
- RabbitMQ管理: http://localhost:15672

### 3. 外网部署模式 (生产环境)

#### 使用Nginx反向代理
```bash
# 1. 启动后端服务
docker-compose -f config/docker/docker-compose-network.yml up -d

# 2. 配置Nginx
cp config/nginx/nginx.conf /etc/nginx/nginx.conf

# 3. 启动Nginx
sudo systemctl start nginx
# 或
sudo nginx
```

#### 使用Docker网络模式
```bash
# 启动完整网络服务
docker-compose -f config/docker/docker-compose-network.yml up -d

# 访问地址
# 前端: http://your-server-ip
# API: http://your-server-ip/api
```

## 🔧 环境配置

### 数据库配置
```bash
# 创建数据库
./scripts/database-migration/create_imagentx_db.sh

# 或完整迁移
./scripts/database-migration/migrate_to_imagentx.sh
```

### 环境变量配置
```bash
# 复制环境变量模板
cp .env.example .env

# 编辑配置
vim .env
```

主要配置项:
```env
# 数据库配置
DB_HOST=localhost
DB_PORT=5432
DB_NAME=imagentx
DB_USER=imagentx_user
DB_PASSWORD=imagentx_pass

# 应用配置
SERVER_PORT=8088
FRONTEND_PORT=3000
JWT_SECRET=your_jwt_secret

# 管理员账户
IMAGENTX_ADMIN_EMAIL=admin@imagentx.ai
IMAGENTX_ADMIN_PASSWORD=admin123
```

## 📊 服务状态检查

### 检查服务状态
```bash
# 使用脚本检查
./scripts/core/start.sh --status

# 手动检查
./scripts/utils/check-services-status.sh
```

### 检查端口占用
```bash
# 检查常用端口
./scripts/utils/detect-ports.sh
```

### 查看日志
```bash
# 查看Docker容器日志
docker-compose -f config/docker/docker-compose-network.yml logs

# 查看特定服务日志
docker logs imagentx-backend
docker logs imagentx-frontend
```

## 🛠️ 故障排除

### 常见问题

#### 1. Java版本问题
```bash
# 错误: No compiler is provided in this environment
# 解决: 安装JDK 17
# macOS
brew install openjdk@17
export JAVA_HOME=/opt/homebrew/opt/openjdk@17

# Ubuntu
sudo apt install openjdk-17-jdk
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
```

#### 2. 端口被占用
```bash
# 检查端口占用
lsof -i :3000
lsof -i :8080
lsof -i :8088

# 杀死占用进程
kill -9 <PID>
```

#### 3. Docker镜像拉取失败
```bash
# 配置Docker镜像源
# 编辑 ~/.docker/config.json
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ]
}

# 重启Docker
sudo systemctl restart docker
```

#### 4. 数据库连接失败
```bash
# 检查数据库状态
docker exec imagentx-postgres psql -U postgres -c "SELECT version();"

# 重新创建数据库
./scripts/database-migration/create_imagentx_db.sh
```

### 清理环境
```bash
# 停止所有服务
./scripts/core/start.sh --clean

# 清理Docker
docker-compose -f config/docker/docker-compose-network.yml down -v
docker system prune -f
```

## 📱 移动端适配

项目支持移动端访问，前端会自动适配不同屏幕尺寸。

## 🔐 安全配置

### 生产环境安全设置
```bash
# 1. 修改默认密码
# 编辑 .env 文件
IMAGENTX_ADMIN_PASSWORD=your_secure_password

# 2. 配置JWT密钥
JWT_SECRET=your_very_secure_jwt_secret_key

# 3. 配置HTTPS (外网部署)
# 在Nginx配置中添加SSL证书
```

## 📈 性能优化

### 本地开发优化
```bash
# 使用缓存
npm install --legacy-peer-deps --cache .npm-cache

# 并行构建
./mvnw -T 1C clean compile
```

### 生产环境优化
```bash
# 启用Docker构建缓存
docker build --build-arg BUILDKIT_INLINE_CACHE=1 .

# 配置Nginx缓存
# 在nginx.conf中添加缓存配置
```

## 📞 技术支持

### 日志位置
- 应用日志: `logs/`
- Docker日志: `docker logs <container_name>`
- 系统日志: `/var/log/`

### 常用命令
```bash
# 启动服务
./scripts/core/start.sh --local

# 检查状态
./scripts/core/start.sh --status

# 清理环境
./scripts/core/start.sh --clean

# 查看帮助
./scripts/core/start.sh --help
```

### 文档链接
- [API文档](docs/api/)
- [部署指南](docs/deployment/)
- [开发文档](docs/developer-guide/)
- [用户指南](docs/user-guide/)

---

**注意**: 首次启动可能需要较长时间下载依赖和构建项目，请耐心等待。
