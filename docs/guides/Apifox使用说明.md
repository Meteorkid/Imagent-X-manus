# Imagent X智能对话系统平台 - Apifox 接口测试使用说明

## 📥 导入项目

1. 打开 Apifox
2. 点击 "导入" → "导入数据"
3. 选择 `ImagentX-Apifox-Collection.json` 文件
4. 点击 "导入"

## 🌍 环境配置

### 选择环境
导入后，在右上角选择对应的环境：
- **本机开发环境**：`http://localhost:8088/api`
- **内网访问环境**：`http://192.168.1.63:8088/api`
- **公网访问环境**：`http://163.142.180.93:8088/api`

### 环境变量说明
- `BASE_URL`：后端API基础地址
- `FRONTEND_URL`：前端访问地址
- `GATEWAY_URL`：MCP网关地址
- `RABBITMQ_URL`：RabbitMQ管理地址

## 🔐 认证配置

### 1. 获取访问令牌
1. 运行 "用户认证" → "用户登录" 接口
2. 使用账号：`admin@imagentx.ai` / `admin123`
3. 从响应中复制 `token` 值

### 2. 配置全局认证
1. 在项目变量中设置 `TOKEN` 值
2. 或者配置全局 Bearer Token 认证

## 🧪 测试流程

### 第一步：健康检查
1. 运行 "后端健康检查"：`GET {{BASE_URL}}/health`
2. 期望：200 状态码，返回 `{"message":"ok"}`

### 第二步：用户登录
1. 运行 "用户登录" 接口
2. 复制返回的 token 到项目变量 `TOKEN`

### 第三步：验证认证
1. 运行 "获取当前用户信息" 接口
2. 期望：200 状态码，返回用户信息

### 第四步：功能测试
按需测试各个功能模块的接口

## 📋 接口集合说明

### 系统健康检查
- 后端、前端、网关、RabbitMQ 健康状态检查

### 用户认证
- 登录、注册、获取用户信息、刷新令牌

### Agent管理
- 创建、查询、更新、发布、版本管理

### 会话聊天
- 创建会话、发送消息、获取历史、删除会话

### 工具市场
- 工具列表、安装、管理、上传

### RAG知识库
- 数据集管理、文件上传、搜索、流式聊天

### LLM模型管理
- 模型列表、提供商配置

### API密钥管理
- 密钥创建、状态管理、删除

### 管理员接口
- 用户管理、统计信息、订单管理

## 🔧 常见问题

### 1. 接口返回 401/403
- 检查是否已配置 `TOKEN` 变量
- 确认 token 是否过期
- 重新登录获取新 token

### 2. 接口返回 500
- 检查后端服务是否正常运行
- 查看后端日志：`docker logs -f imagentx`
- 确认请求参数格式是否正确

### 3. 连接超时
- 检查网络连接
- 确认环境变量中的地址是否正确
- 验证防火墙设置

### 4. 变量替换失败
- 检查变量名是否正确（区分大小写）
- 确认变量值是否已设置
- 使用 `{{变量名}}` 格式

## 📝 测试建议

### 基础功能测试
1. **健康检查**：确保所有服务正常运行
2. **用户认证**：验证登录流程
3. **基础CRUD**：测试创建、查询、更新、删除操作

### 高级功能测试
1. **文件上传**：测试RAG文件上传功能
2. **流式响应**：测试聊天和RAG的流式接口
3. **权限控制**：测试不同用户角色的权限

### 性能测试
1. **并发请求**：使用Apifox的批量执行功能
2. **响应时间**：监控接口响应时间
3. **错误率**：统计接口成功率

## 🚀 快速开始

### 最小测试集
1. 健康检查 → 确认服务可用
2. 用户登录 → 获取认证token
3. 获取用户信息 → 验证认证
4. 获取Agent列表 → 测试业务接口

### 完整测试流程
1. 系统健康检查（所有接口）
2. 用户认证流程
3. Agent创建和配置
4. 会话聊天测试
5. 工具安装和使用
6. RAG知识库操作
7. 管理员功能验证

## 📞 技术支持

如遇到问题：
1. 检查后端服务状态：`docker ps`
2. 查看服务日志：`docker logs -f imagentx`
3. 验证网络连通性：`curl http://localhost:8088/api/health`
4. 参考项目文档或提交Issue

---

**提示**：建议先使用"本机开发环境"进行测试，确认功能正常后再测试内网和公网环境。


