# 🏠 本地到云端部署指南

## 📋 部署策略

### 阶段1: 本地测试（已完成 ✅）
- 在本地Mac上运行ImagentX项目
- 验证所有功能正常工作
- 测试数据库、消息队列等组件

### 阶段2: 云服务器部署（推荐）
- 购买云服务器（阿里云/腾讯云）
- 上传项目代码到服务器
- 配置域名解析
- 部署到生产环境

### 阶段3: 内网穿透测试（可选）
- 使用ngrok等工具
- 临时让外网访问本地服务
- 用于演示或临时测试

## 🚀 推荐部署方案

### 方案A: 直接云服务器部署（推荐）

#### 优势
- ✅ 稳定可靠
- ✅ 性能好
- ✅ 支持SSL证书
- ✅ 专业运维
- ✅ 成本可控

#### 成本
- 云服务器: ¥80-200/月
- 域名: ¥50-100/年
- 总计: ¥1000-2500/年

#### 步骤
1. 购买云服务器
2. 配置DNS解析
3. 上传部署包
4. 执行部署脚本
5. 验证访问

### 方案B: 内网穿透 + 云服务器

#### 优势
- ✅ 可以先在本地测试
- ✅ 临时外网访问
- ✅ 成本低

#### 劣势
- ❌ 不稳定
- ❌ 速度慢
- ❌ 不适合生产环境
- ❌ 无法配置SSL

## 🔧 内网穿透配置（临时测试用）

### 使用 ngrok

#### 1. 安装ngrok
```bash
# 在Mac上安装
brew install ngrok

# 或者下载安装
curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
```

#### 2. 注册并获取token
1. 访问 [ngrok官网](https://ngrok.com/)
2. 注册免费账号
3. 获取authtoken

#### 3. 配置token
```bash
ngrok config add-authtoken YOUR_TOKEN_HERE
```

#### 4. 启动内网穿透
```bash
# 穿透80端口（如果本地服务运行在80端口）
ngrok http 80

# 或者穿透3000端口（如果前端运行在3000端口）
ngrok http 3000
```

#### 5. 获取公网地址
ngrok会显示类似：
```
Forwarding    https://abc123.ngrok.io -> http://localhost:80
```

#### 6. 配置域名解析
- 将 `imagentx.top` 解析到ngrok提供的IP
- 或者直接使用ngrok提供的域名

### 使用 frp（免费开源）

#### 1. 下载frp
```bash
wget https://github.com/fatedier/frp/releases/download/v0.51.3/frp_0.51.3_darwin_amd64.tar.gz
tar -xzf frp_0.51.3_darwin_amd64.tar.gz
cd frp_0.51.3_darwin_amd64
```

#### 2. 配置frpc.ini
```ini
[common]
server_addr = frp服务器地址
server_port = 7000
token = 您的token

[web]
type = http
local_port = 80
custom_domains = imagentx.top
```

#### 3. 启动frp客户端
```bash
./frpc -c frpc.ini
```

## 🌐 云服务器部署（推荐）

### 1. 购买云服务器
推荐配置：
- **CPU**: 2核
- **内存**: 4GB
- **存储**: 40GB SSD
- **带宽**: 5Mbps
- **系统**: Ubuntu 20.04 LTS

### 2. 配置DNS解析
```bash
# 在域名管理后台添加A记录
@ -> 服务器IP
www -> 服务器IP
```

### 3. 上传部署包
```bash
# 在本地Mac上执行
cd /Users/Meteorkid/Downloads/ImagentX-master
scp imagentx-deploy.tar.gz root@[服务器IP]:/opt/
```

### 4. 服务器部署
```bash
# 在服务器上执行
mkdir -p /opt/imagentx
cd /opt/imagentx
tar -xzf /opt/imagentx-deploy.tar.gz
chmod +x *.sh
./quick-deploy.sh --setup
./quick-deploy.sh --deploy
```

## 📊 方案对比

| 方案 | 稳定性 | 性能 | 成本 | 配置难度 | 推荐指数 |
|------|--------|------|------|----------|----------|
| 云服务器 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| ngrok | ⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| frp | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |

## 🎯 建议

### 临时测试
- 使用ngrok进行临时外网访问
- 用于演示或功能验证

### 正式部署
- 购买云服务器进行正式部署
- 配置域名和SSL证书
- 确保稳定性和性能

### 开发测试
- 继续在本地进行开发
- 定期同步到云服务器

## 🚀 立即行动

### 如果您想快速测试外网访问：
```bash
# 1. 确保本地服务运行
./scripts/core/start.sh --production

# 2. 安装ngrok
brew install ngrok

# 3. 启动内网穿透
ngrok http 80
```

### 如果您想正式部署：
1. 购买云服务器（推荐阿里云）
2. 配置DNS解析
3. 使用部署包进行部署

**您想选择哪种方案？我可以为您提供详细的操作指导！** 🎯
